# Product Requirements Document: MCP Prompts 引導式工作流程系統

## Introduction/Overview

當前的 Codebase RAG MCP 服務器提供了強大的代碼索引和搜索功能，但用戶在獲得搜索結果後，往往不知道下一步應該做什麼。缺乏引導性和推薦系統讓用戶難以快速獲得項目全貌，特別是在面對大型重構任務時。

本功能旨在通過實現 MCP Prompts 系統，提供智能引導式工作流程，幫助用戶（AI 代理和開發者）更高效地探索和理解代碼庫，並在複雜任務中獲得結構化的指導。

## Goals

1. **提升工具發現性**：通過 MCP Prompts 讓用戶更容易發現和使用各種功能
2. **提供智能引導**：基於當前上下文推薦下一步行動，減少用戶的迷茫感
3. **支援大型重構**：為大型重構項目提供系統性的分析和指導流程
4. **加速項目理解**：讓新開發者能夠快速理解項目架構和實現細節
5. **增強 AI 代理能力**：為 AI 代理提供結構化的工作流程，提高分析品質

## User Stories

### 主要用戶故事

1. **作為一個新加入項目的開發者**，我想要快速理解代碼庫結構，以便能快速承接此專案之開發
   - 我需要系統性的項目導覽
   - 我需要識別關鍵入口點和核心模塊
   - 我需要理解項目的架構模式和設計決策

2. **作為一個 AI 代理**，我想要有引導性的工作流程，以便讓我接下來能更全面且仔細的提供使用者專案全貌或細節，以便讓使用者能與我合作快速開發、debug
   - 我需要結構化的分析流程
   - 我需要上下文感知的推薦系統
   - 我需要能夠鏈接多個分析步驟的機制

3. **作為一個進行大型重構的開發者**，我想要有系統性的分析工具，以便能夠安全且高效地完成重構任務
   - 我需要全面的依賴關係分析
   - 我需要影響範圍評估
   - 我需要重構風險評估和建議

### 次要用戶故事

4. **作為一個代碼審查員**，我想要快速理解變更的影響範圍，以便提供更精準的審查意見

5. **作為一個技術負責人**，我想要獲得項目健康度報告，以便做出技術決策

## Functional Requirements

### 核心 Prompts 功能

1. **系統必須提供 `explore_project` Prompt**
   - 分析整個項目的架構結構
   - 識別關鍵模塊和依賴關係
   - 提供項目概覽和導航建議
   - 生成項目結構圖表或摘要

2. **系統必須提供 `understand_component` Prompt**
   - 深度分析指定的組件或模塊
   - 解釋組件的職責和介面
   - 識別組件的依賴和被依賴關係
   - 提供使用範例和最佳實踐

3. **系統必須提供 `trace_functionality` Prompt**
   - 追蹤特定功能的完整實現路徑
   - 識別從 API 到資料庫的完整調用鏈
   - 顯示相關的配置和環境設定
   - 提供功能修改的影響分析

4. **系統必須提供 `find_entry_points` Prompt**
   - 自動識別項目的主要入口點
   - 分析路由、控制器、主函數等
   - 提供入口點的文檔和使用說明
   - 建議學習路徑和閱讀順序

### 智能推薦功能

5. **系統必須提供 `suggest_next_steps` Prompt**
   - 基於當前分析結果推薦後續行動
   - 考慮用戶角色和技能水平
   - 提供個性化的學習或工作建議
   - 支援多種場景（學習、開發、重構、調試）

6. **系統必須提供 `optimize_search` Prompt**
   - 分析用戶的搜索模式和結果
   - 建議更有效的搜索策略
   - 推薦相關的搜索關鍵詞
   - 提供搜索結果的深度分析

### 工作流程功能

7. **系統必須支援 Prompt 鏈接機制**
   - 允許一個 Prompt 的結果作為另一個 Prompt 的輸入
   - 維護工作流程的上下文狀態
   - 提供工作流程的暫停和恢復功能

8. **系統必須提供上下文記憶功能**
   - 記錄用戶的探索歷程
   - 基於歷史行為提供個性化建議
   - 支援工作階段的持久化存儲

### 整合功能

9. **系統必須整合現有的 MCP 工具**
   - 無縫調用現有的搜索和索引功能
   - 利用智能代碼分塊的結果
   - 整合項目分析和性能監控數據

10. **系統必須提供發現性機制**
    - 在 Claude Code 中顯示為斜杠命令
    - 提供 Prompt 的描述和使用範例
    - 支援 Prompt 的分類和標籤

## Non-Goals (Out of Scope)

1. **不包含 UI 介面開發**：專注於 MCP Prompts 的後端實現，不涉及圖形化用戶介面

2. **不包含版本控制整合**：暫不實現與 Git 等版本控制系統的深度整合

3. **不包含持續整合支援**：不涉及 CI/CD 流程的整合和自動化

4. **不包含多語言翻譯**：暫時只支援英文和中文，不支援其他語言

5. **不包含複雜的機器學習模型**：使用現有的嵌入模型，不開發新的 ML 演算法

6. **不需要向後兼容**：可以對現有 API 進行破壞性更改

## Design Considerations

### Prompt 設計原則
- **漸進式揭示**：從高層概覽逐步深入到具體細節
- **上下文感知**：根據項目類型和用戶角色調整建議
- **可組合性**：Prompts 能夠組合使用，形成複雜的工作流程
- **可發現性**：清晰的命名和描述，易於理解和使用

### 用戶體驗設計
- **減少認知負荷**：提供清晰的步驟指導，避免信息過載
- **即時反饋**：每個步驟都提供明確的結果和下一步建議
- **個性化**：根據用戶的技能水平和偏好調整輸出格式
- **錯誤恢復**：提供清晰的錯誤信息和恢復建議

## Technical Considerations

### 架構要求
- **基於 FastMCP 框架**：擴展現有的 MCP 工具實現
- **模組化設計**：Prompts 系統應該是可插拔的模組
- **效能考量**：Prompts 執行不應明顯影響現有搜索功能的性能
- **記憶體管理**：合理管理上下文資料，避免記憶體洩漏

### 整合考量
- **與現有服務整合**：重用現有的代碼解析、索引和搜索服務
- **配置管理**：支援 Prompts 的動態配置和客製化
- **錯誤處理**：統一的錯誤處理和日誌記錄機制
- **測試支援**：提供完整的單元測試和整合測試

### 資料流設計
- **輸入驗證**：確保 Prompt 參數的有效性和安全性
- **結果快取**：對常用的分析結果進行智能快取
- **非同步處理**：支援長時間運行的分析任務

## Success Metrics

### 使用者體驗指標
- **學習時間減少**：新開發者理解項目的時間減少 60-80%
- **任務完成率**：用戶能夠完成複雜分析任務的成功率 > 90%
- **工具發現率**：用戶發現和使用新功能的比例增加 > 200%

### 技術性能指標
- **回應時間**：Prompt 執行時間 < 30 秒（95 百分位）
- **準確性**：推薦的相關性和準確性 > 85%
- **系統穩定性**：Prompts 功能的可用性 > 99.5%

### 業務影響指標
- **重構支援**：成功支援大型重構項目的案例數
- **用戶滿意度**：通過使用反饋調查測量
- **採用率**：AI 代理和開發者的實際使用率

## Open Questions

1. **上下文持久化範圍**：用戶的探索歷程應該保存多久？如何處理隱私問題？

2. **Prompt 優先順序**：當有多個可能的下一步建議時，如何決定推薦順序？

3. **客製化程度**：是否需要支援用戶自定義 Prompts？如果是，提供什麼樣的客製化介面？

4. **多項目支援**：如何處理跨項目的上下文和建議？

5. **效能優化**：對於大型代碼庫，如何確保 Prompts 的執行效率？

6. **錯誤恢復策略**：當 Prompt 執行失敗時，如何提供有意義的錯誤信息和恢復建議？

7. **學習機制**：是否需要實現基於用戶行為的學習機制來改善推薦品質？